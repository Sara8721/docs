# Tokenomics V1

## Background

Proof of Stake (PoS) has doubtlessly grown into an indispensable consensus mechanism to date. It is widely acknowledged in the crypto world. In 8 arduous years since 2012, a number of teams has devoted themselves into addressing technical problems, such as Nothing at Stake, Long-range Attack, etc. Till 2018, PoS is nearly a sophisticated mechanism, and in the later half of this year, a string of PoS (or PoS-like) projects, with EOS and Tezos at the center, has been launched, marking the application of a new generation of consensus. The following 2 years saw the rapid development of PoS projects, exemplified by cutting-edge public chains, such as Polkadot, Near, Solana, Celo, and so forth, that all adopted PoS as its consensus mechanism. 

Incentives and security are of the biggest concerns for PoS. The incentive mechanism of PoS, with security at its core, is different to that of PoW, while Staking brought a totally new kind of incentive approach for PoS, hence a dawn business model--Staking Finance. Finance applications that took Staking as incentives means have been widely applied, and is ever-changing with the development of the blockchain technology. It can be said that Staking has become one of the most important designs in PoS projects, which brings new user experience, as well as new problems to be tackled, especially experience concerning user’s security.

Stafi focuses on the liquidity issues in Staking Finance. The incentive is designed in the form of rewards to Token Staking. At the same time, if a user is engaged in Staking, s/he is virtually part of the consensus, which requires stability and security. That explains why there is a lock-up mechanism for Staking Token. There is a certain period to the lock-up of tokens Staked, which is also the prerequisite for obtaining rewards. There’s a underlying problem to it, which is, under today’s immature token markets, drastic market fluctuation may cause the depreciation of a token. Under this circumstance, rewards can hardly cover a Staker’s loss in most cases.

There comes Stafi. With it, Staking tokens can be profitable and tradable at the same time. Stafi boasts a unique Staking Contracts (referred to SCs), which makes Staking Tokens that way. Therefore, users are given more possibilities through Staking. This is what Stafi has been dedicated to. 

## Introduction

The protocol of StaFi is created by Substrate and adopts Nominated Proof-of-Stake (NPoS), which complete Staking by setting up Staking Contracts in the upper layer to communicate with public chains. The Staking process is immune to Stafi’s contracts, for the latter act as the account book during Staking. Tokens staked through contracts will be written in the contracts and finally be locked-up on the original chain.

In order to maintain StaFi protocol, Stafi Validators (SV) and Stafi Special Validators (SSV) are essential. SVs are responsible for the security of the whole protocol while SSVs guarantee the safety of all Staking Contracts. Under the protocol framework, the election of validators and the motivations for them become paramount, which will be expounded in the third part of this document. 

FIS is the native tokens of StaFi. FIS is involved in 3 scenarios: Gas, Staking and value capture. 
- FIS is the fuel of the system. It prevents a large sum of spam popping up in the system. FIS charged will be distributed to validators and Protocol Treasury, and the distribution ratio can be adjusted by concerning parameters.
- Stafi adopts NPoS consensus and uses the underlying motivation design of Polkadot for reference. Based on security design, Stafi tunes up motivation curve in accordance of the Staking ratio of FIS in order to achieve the cyber security and long-term development of the system.
- FIS is a medium for the value capture in Stafi system (mainly provides value for the liquidity of rToken). The Staking Contracts of Stafi not only provides Staking service for Stakers, but also guarantee liquidity. Service fee will be charged by Stafi protocol from users to value to Stafi network. The proposition of value will be expounded in part 5 of this document.

rTokens (reward Token) are alternative tokens given to Staking token holders. Due to Staking tokens will be locked up on the original chain, and the lockup relations will be written to Staking Contracts, rTokens are the only authentication ticket manipulated by Staking contracts. Through rTokens, holders can alternate relations of the contracts, execute further Staking, redeem original tokens, etc. Meanwhile, by holding rTokens a user can obtain rewards from Staking tokens, which will be explained in part 4.  

In a nutshell, StaFi protocol can be regarded as an underlying protocol for crypto assets. Through rTokens, the protocol can free Staking Tokens, backing them to the market. StaFi earns income from providing liquidity. The value chain involves the interaction of different models, which will be detailed in the following parts.

## Motivation

Substrate integrates a consensus mechanism-BABE and GRANDPA. BABE is responsible for block selection and GRANGDPA determines the finality of the block. As for block selection, Stafi adopts the election system. A validator obtains its block weight by Staking FIS or accepting the nomination of Staked FIS. After the new block is confirmed by the GRANDPA consensus, the chain that more than ⅔ Staked FIS voted for becomes the final chain, of which the latest block producer will be rewarded.

## StaFi Validator (SV)

### Election

Anyone who wants to engage the network and provide security protection is positioned to become a validator by maintaining a node, if you are nominated by Staking, you can possibly act as one. One can Stake him/herself or nominate a Staker, but the possibility of becoming a validator is determined by the overall level of Staking.

In the primary phase, in order to maintain the security and stability of the network, Stafi will open up some posts of SVs to the public. Users who ranks high in the amount of Stake will be shortlisted in the final consensus selection. However, when the network is mature, Stafi protocol will determine whether to recruit more SVs by on-chain voting. 

In the world of StaFi, certain periods of time are defined by how many blocks are produced in that period-for each block is produced in 6 seconds, give or take. 1 epoch=1 hour; 1 Era=24 epoch=24 hours. During each Era, the election for the next era will be carried out. Each Slot allows multiple block producers, and the consensus mechanism select BPs by VRF algorithm. When more than one blocks are produced in a Slot, the block that reaches to the farest end of the network will be the final block, and the producer of it will be rewarded. 

### Withdrawal

During each Era, the elected SV carries out block-producing and voting, but when a SV cannot perform duty as required, it will be withdrawn till the next election round. The conditions for a withdrawal are as follows:

- When a SV does evil, it will be Slashed by the system, and it will be withdrawn automatically. Its nomination will be re-distributed by algorithm.
- When a SV remains unresponsive/offline to a certain degree during an Era, which is gauged by the possibility of missing a block, it will be withdrawn. Its nomination will be re-distributed by algorithm. 

During the withdrawal period, the nomination will not be motivated.
 
### Reward

Under the NPoS design of Stafi, the following 3 patterns of a SV will be rewarded:
- block-producing (non-uncle blocks in the relay chain)
- producing uncle blocks (previously unreferenced uncles)
- producing orphan blocks (referenced uncle blocks)

In order to guarantee block-producing, each block producer is elected by VRF algorithm. At the same time, the consensus will also elect alternate block producers by Round-Robin algorithm in advance in case that block producers do not perform their duty. In this way, each slot will necessarily be filled up with newly-produced blocks, and the final block is the one confirmed by GRANDPA, the others become uncle blocks, whereas those orphan blocks behind them will be also rewarded, fewer of course.

SVs pay the equivalent amount of work to produce a block, whether it be the final block, an uncle block or an orphan block. Therefore, the reward for a SV for producing a single block remains the same. Meanwhile, in NPoS design, each SV is entitled to equal Voting Power, not matter how much nominated Stake it receives. That is to say, each SV shares the same chance of being elected. Of course, the amount of Stake you own determines whether you are qualified to be elected.

The chance to produce a block is equal to all validators, which means there is no direct relevance between reward distribution and the weight of Stake. While in the PoS version of some projects, the possibility of producing a block is proportionate to the weight of Stake--more Stake will be given more chances to produce, thus more rewards. Judging from the existing projects, there is a tendency that Stake is gathering towards dominating block producers. In many cases, top 10 producers accounts for more than half of all Stake. NPoS can effectively tackle this problem, for the equal chance to produce balances the distribution of Stake, making the system much more decentralized. Currently, NPoS consensu is being tested in Kusama network.

For nominators, the fewer Stake Validators you nominates, the more rewards you can get, and vice versa. The nomination to a certain piece of FIS can obtain more rewards on a SV with fewer nomination. However, that kind of SV may have some risks, such as long-time offline, immature technical capabilities, lack of fame, or be inexperienced in node business. These factored are to be noted by nominators. 

In order to better distribute rewards, Stafi records each validator’s rewards in each epoch. At the same, each reward cycle is 1 Era. A SV can claim its rewards when an Era ends, and when it is claimed, the protocol will automatically distribute rewards proportionate to the amount of Stake (It should be noted that if rewards haven’t been claimed within 84 Era, it will be burnt. We strongly recommend a SV to claim in advance.)

The rewards to the completion of producing each kind of block are as follows: 

| Type | blocks | Uncle blocks | Orphan blocks |
| :------------ | :--------- |  :--------- |  :--------- |
| Rewards counting | 20 | 2 |  1 |

Assuming that the validator is v, the number of blocks generated in an Era e is n, the number of Uncle blocks is s, and the number of orphan blocks is x, then the total reward count r obtained by the validator during e is

$r_{s}=20n+2s+x$

Assuming that there are 100 validators in a set, that is `{v1,v2,v3,...,v100}`, then during e, the total reward count R of all validators is

$R_{e}=r_{1}+r_{2}+r_{3}+...+r_{100}= \sum_{n=1}^{100} r_v$

Further, it can be deduced that

$R_{e}=\sum_{n=1}^{100}(20n_v+2s_v+x_v)$

If the Stake rate is 50% and the inflation rate is 10% at this time, the total reward during e can be calculated (for details, please check part 3):

$P_{NPoS}^{e}$

Then the reward that a single validator gets during e

$\frac{r_{v_n}^e}{R_e} P_{NPoS}^{e}$

After deducting the fee of the validator, the nominator can get its own proportion of the remaining reward.

### Slash

Slash is a punishment for “illegal” behaviors of SVs in the consensus, for misconducts may cause problems such as system unstability or even system crash. For such problems, the NPoS consensus punishes “illegal” validators by “forfeiting” the Stake. Similar to reward calculations, penalty is calculated during every Era. The types and methods of punishment are as follows.

**Off-line/Unresponsive**

If a SV does not produce any block or send heartbeats test in an Era, then it will be judged as offline/unresponsive. When there are many offline/unresponsive nodes, the system will start to confiscate part of Staked tokens (including validators and nominees) as a regulation method. To make the punishment accurate and public, we set the following formula

$min((3*(k-(n/10+1)))/n,1)*0.07$

In the formula, n is the total number of SVs, k is the number of offline SVs. Note that when `k-(n / 10 + 1)<0`, the penalty is 0. Suppose there are 100 SVs, n = 100

Assuming n = 100,

- When k = 1 ~ 11, the ratio of Slash is 0;
- When k = 12, the ratio of Slash is 0.03 * 0.07 = 0.0021
- When k = 21, the ratio of Slash is 0.3 * 0.07 = 0.021
- When k = 31, the ratio of Slash is 0.6 * 0.07 = 0.042
- When k = 41, the ratio of Slash is 0.9 * 0.07 = 0.063
- When k = 51, the ratio of Slash is 1 * 0.07 = 0.07

In general, the ratio of Slash is from 0 to 7%. When less than 10% of all nodes are offline, a single node will not be slashed if it is offline or not responding. When 1/3 nodes are offline at the same time, the Slash ratio is close to 5 %.

**Double-signing**

In order to maintain the security of the system, during both the block-producing phase (Babe consensus) and the voting phase (Grandpa consensus), voting on different chains during a single round, or generating two new blocks in the same block slot will be considered malicious. The penalty formula is as follows

$min((3k/n)^2,1)$

In the formula, n is the number of SVs, k is the number of chaotic or invalid voters of SVs.

Suppose n = 100

- When k = 1, the ratio of Slash is 0.03 * 0.03 = 0.0009
- When k = 10, the ratio of Slash is 0.09
- When k = 21, the ratio of Slash is 0.3969
- When k = 31, the ratio of Slash is 0.81
- When k = 41, the ratio of Slash is 1
- When k = 51, the ratio of Slash is 1

In general, the largest Slash ratio is 1, which means that a SV may be slashed 100% of Stake. It is easily recognized that the punishment for double-signing is more serious than the offline punishment, and even if just 1 SV will be punished for double-signing.
 
## Stafi Special Validator (SSV)

Stafi Special Validators are to guarantee the security of Staking Contracts, which record the correlation between assets on original chains and rTokens, thus of paramount importance. The most fundamental design of Staking Contracts is a multi-signature account on the chain, which may vary among different Staking chain’s contracts or corresponding.
The election of SSVs are independent from that of SVs. Due to a higher security level, special services are designed, including signature, RPC and Oracle service--though during the kick-off phase of Stafi, the the last one may not be needed. Those services also are the approaches to motivate SVVs. The motivation also is independent. That is to say, SSVs can not only obtain their own rewards, but also that of SV’s.
 
### Election

The number of special validator SSVs is determined according to the deployed Staking contract. Each new Staking contract deployment requires a new batch of SSVs to manage. The specific SSV number needs to be allocated according to the amount of assets managed by the Staking contract to meet security needs. 

SSVs are elected from SVs, and the existing SVs can register as a SSV by deploying SSV services. The system will select SSVs from them according the amount of Stake, online rate, Stake ratio of itself, etc. Once a SV is registered successfully, it will enter the SSV candidate pool. All SSVs inside the pool will take turns or join in the election when a new Staking Contract is deployed. 

Before each election Era for SSV begins, the system will select by the registration situation of SVs. SVs which have larger nomination will have an edge getting into the pool. Besides, assets pledged by SSVs are all from SVs. But compared to a SV, a SSV requires higher self-Staking ratio. When Slash happens, SSV will be punished heavier.  

There are two types of SSV rotation--regular rotation and emergency rotation. Both are designed to meet the security needs of assets. Regular rotation is to ensure the dynamity of SSV, and at the same time, to allow the reward to cover the SSV in the candidate pool as fairly as possible. Whereas the emergency rotation usually occurs when the number of signers is close to the limit. Let’s say each round, N out of M signers are needed, but the actual number of signers S is close to or equal to (M-N), the system will urgently replace incumbent SSVs that do not provide signatures. Through this, the activity of the number of signers is guaranteed. Whether it is a regular rotation or an emergency rotation, both will need new SSVs, and the ex-SSVs will take a rest, waiting for the next round of elections. SSVs that are resting will not be able to get any rewards. Due to the requirement of flexibility, SSV's election cycle takes 1 Era as one round. We are still exploring a more appropriate cycle. If found, we can use online governance parameters.
 
### Withdrawl

Within 1 Era, elected SSVs will perform signing, but when a SSV cannot meet the demand required, it will be withdrawn and banned the right to participate in next round’s election. The conditions for a withdrawal are as follows:

- When a SSV does evil, it will be Slashed by the system, and it will be withdrawn automatically. It cannot participate in the next round of election.
- When a SSV wrongly or do not sign to a certain degree during an Era, it will be withdrawn. 
- When a SSV is withdrawn, SSV signature that haven’t be rotated cannot generate any reward. 

### Reward

The reward for SSV is independent from that of SV. In order to maintain the security of the Staking Contract, multi-signatures engage in adding, deleting, modifying and monitoring the contract. On the other hand, RPC provides reliable support for the Staking process. In addition, StakingDrop in the Stafi protocol that is based on price-feed also requires SSV to operate Oracle for support. Under the current protocol, Stafi has two main incentives for SSV: one is multi-signature service, and the other is RPC service. 

The rewarding principle is similar to that of producing blocks--get more rewards for more work done. Regarding the multi-signature service, the number of times of signing is counted while in the RPC service, the number of times the service is called is counted. During 1 Era, Stafi protocol will set the corresponding service count, the initial set count is as follows:

| Type | Singing | RPC Call |
| :------------ | :--------- |  :--------- |
| Rewards counting | 20 | 2 |

Tips: The specific multi-sign technology and RPC call calculation scheme will be detailed in the Stafi product documentation.

The reward obtained by a single SSV in an Era is determined by the proportion of services provided by this SSV, which can be calculated by signatures and RPC calls of all SSVs in the Era. For example: suppose that within Era e, an SSV participates in signing 50 times and RPC calls 1000 times, then in this Era, he gets a count of 3000, and in the current e, the total count is 300000, then 3000 count accounts for 1% of all counts, finally he will receive 1% of the total SSV reward. 

The reward distribution period is 1 Era, and the number of rewards depends on the service usage. Since the annual inflation rate is fixed, we set the total rewards given to SSV by each Era as: 

$$ P_{SSV}^{e}=P_{Signature}^{e}+P_{RPC}^{e} $$

In the early stage of the Stafi Contract, in order to recruit as many SSVs as possible, a relatively smooth transition method of rewarding will be adopted. That is because when the number of SSVs does not reach the ideal number, there will be a grave risk in contract security. To attract SSVs by enlarging incentives is necessary, but in order to prevent a small number of people from taking most of the rewards, creating additional pressure for further issuance, it is necessary to set the reward distribution to a reasonable level. In the absence of abundant data support, the specific distribution of rewards will be led by the Foundation during the transition period. Meanwhile, a reward cap will be set to reduce the pressure for further issuance. The extra rewards will be transferred to Protocol Treasury for other purposes. After a smooth transition to a reasonable level, rewards will be optimized through algorithms and automatically distributed to SSVs to achieve full automation of motivation. 

### Slash

There are two types of punishment actions for SSV (mainly for multi-signature services). The first will be executed when a SSV does not sign during the signature phase; the second when it provides wrong signatures. However what the SSV in both cases may look the same, which is, in the N/M multi-signature system, the number of signers may not reach the minimum N. For SSVs that do not provide signatures or give incorrect signatures, they pose a potential threat for the security of Staking contracts.

In the multi-signature phase, a SSV’ signature will be needed to help the system perform various tasks (including enabling user’s operations, online rotation, etc.). When a SSV does not sign, generally, it is offline or unresponsive. If the signature is not provided in an Era and Heartbeat detection is not sent, a SSV is considered to be unresponsive. If the behavior does not implement the exit strategy at this time, it will be Slashed. In addition, in the multi-signature signature phase, if a SSV provides an incorrect signature, the signature cannot be recognized by the system. The SSV will be withdrawn or Slashed if that happens repeatedly.

Stafi Protocol sets a threshold in the multi-signature system. If the threshold is not met, the assets of a Staking Contract will be under threat. Therefore, Slash goes in tandem with the Withdrawal in most cases as follows:

- When the number of SSVs that provide no signatures or incorrect signatures is smaller than 2/3 of the threshold, the proportion of SSVs that are Slash is small, and they will not be withdrawn;
- When the number of SSVs that provide no signatures or incorrect signatures is bigger than 2/3 of the threshold, the proportion of SSVs that are Slash is big, and they will be withdrawn in the next Era;

The system will Slash SSVs that deliver the aforesaid 2 signature problems, because no signature is the same as incorrect signatures when it comes to the damage to the system. Therefore, the formula is the same for 2 scenarios:

$min((3*(k-(n/10+1)))/n,1)*0.07$

n is the number of validators, k is the number of SSVs that provides no signature or wrong ones.

Assume n=21, and the signature threshold is 12, 

- When k < = 2, the proportion of Slash is 0. 
- When k = 3, the proportion of Slash is 0.002. 
- When k = 4, the proportion of Slash is 0.00814. 
- When k = 5, the proportion of Slash is 0.01836. 
- When k = 8, the result is 0.07346. 
- When k > = 9, the result is 0.1

Generally speaking, when the number of SSVs that provides no signature or wrong ones is bigger than 2, the security deposit of SSVs will be forfeited. The ratio of Slash is between 0 and 0.1, the bigger k is, the closer to 0.1. 

## Inflation

The rewards for a SV or a SSV come from system inflation, similar to Coinbase mechanism of Bitcoin. Stafi Protocol will generate new FIS (the process is called Coinstake) every time when a new block is produced, which is used to motivate SVs and SSVs that provides computing and storage resources. Controlling inflation rate is an economic issue. According to historical evolution and a large number of data, the annual inflation rate of PoS projects at this stage is around 5% and 20%.
 
In Stafi Protocol, there are following aspects that influence inflation rate:

$I=I_{NPoS}-I_{Slashing}-I_{Tx-fee}$

Of which:

$I_{NPoS}=I_{SV}+I_{SSV}$
 
is system consensus rewards. In Stafi, it means both rewards for SV and for SSV. Slash's FIS and transaction fee's FIS, some will be distributed to the reporter, and some will be added to Protocol Treasury.

is effected by Staking rate. If we put other factors aside, the higher the Staking rate is, the more secure a system will be, and vice versa. The higher the Staking ratio, the lower the liquidity of the token. In FIS design, the inflation rate will dynamically be adjusted to the proportion of Stake. When the proportion of Stake increases, the system will reduce motivation. Otherwise, the motivation will increase. During the repeated adjustments, Stafi protocol explored an ideal Stake ratio of 50%, that is, when the Stake ratio exceeds 50%, the incentive will no longer increase,and  is between 2.5% and 10%. The motivation curve is as follows. The further issuance ratio is 10% in the first year. If the staking rate is below ideal, the excess rewards will be transferred to Protocol Treasury.

is related to service call, including the call for multi-signature service and RPC. During the Staking process, these 2 services need to be called for multiple times. To pay for the services, the system will motivate each call. In the initial setting, the Protocol stipulates a fixed increase of x% as a reward for service calls, and the initial range of x is [1,2].

The rewards for each call will be added up once in a Era. If the calling reward exceeds the system's additional issuance in the Era, the FIS reward for multiple-unit-calls will be reduced accordingly. This strategy will be flexible in the first year after after the mainnet is launched, and then be determined by the community through online governance.

inflation is not a exact number. Under the premise that most people are honest, Stafi Protocol should not Slash a lot, and the chance of serious accidents is relatively small. In the existing PoS project, there have been several double-signing accidents, but most of them were caused by mistakes of the validator, so  has little effect on the overall inflation rate.

inflation is not a definite figure either. It depends on the usage of Stafi network, especially that of rToken. At the current stage, it cannot be evaluated, it will to some degree, reduce inflation along with the development of rToken.